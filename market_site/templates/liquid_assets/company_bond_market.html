{% extends "layout.html" %}
{% block style %}

<style>
    img[company_logo_min] {
        display: inline-block;
        max-height: 1.7em;
    }

    table {
        width: 100%;
    }
</style>

{% endblock %}
{% block content %}
<table tb>
    <tr>
        <td colspan="100">{{ company.name }}</td>
    </tr>
    <tr>
        <td colspan="100">
            <a href="/liquid_assets/company/{{ company.id }}">
            <img company_logo src="/static/companies/{{ company.get_images()[0] }}" alt="{{ company.name }} image">
            </a>
        </td>
    </tr>
    <tr>
        <td colspan="1">Company value</td>
        <td colspan="20"><span class="m">{{ '{:,.2f}'.format(company.value) }}</span></td>
    </tr>
    <tr>
        <td colspan="1">Total bonds</td>
        <td colspan="20">{{ company.bond_number() }}</td>
    </tr>
</table>
<br>
<table tb>
    <tr>
        <th colspan="3">Info</th>
        <th colspan="3">Bond</th>
        <th colspan="2">Sale</th>
        <th colspan="3">Returns</th>
    </tr>
    <tr>
        <th>Company name</th>
        <th>User</th>
        <th>Number of bonds</th>

        <th>Interest rate</th>
        <th>Value</th>
        <th>Full Value</th>


        <th>Sale price</th>
        <th>Full sale price</th>
        <th>Profit / bond</th>
        <th>Full profit</th>
        <th>Returns</th>
    </tr>
    {% for bond_number, sale, bond, user in bond_sales %}
        <tr>
            <td>{{ company.name }}</td>
            <td><a href="/user/{{ user.id }}">{{ user.username }}</a></td>
            <td>{{ bond_number }}</td>
            
            <td><span class="p">{{ "{:,.2f}".format((bond.interest_rate - 1) * 100) }}</span></td>
            <td><span class="m">{{ "{:,.2f}".format(bond.value) }}</span></td>
            <td>
                {% if bond_number > 1 %}
                    <span class="m">{{ "{:,.2f}".format(bond.value * bond_number) }}</span>
                {% else %}
                    /
                {% endif %}
            </td>

            <td><span class="m">{{ sale.price }}</span></td>
            <td>
                {% if bond_number > 1 %}
                    <span class="m">{{ "{:,.2f}".format(sale.price * bond_number) }}</span>
                {% else %}
                    /
                {% endif %}
            </td>
            <td>
                {% set profit_per_bond = bond.value * bond.interest_rate - sale.price %}
                {% if profit_per_bond < 0 %}
                    <span class="m neg">{{ "{:,.2f}".format(profit_per_bond) }}</span>
                {% elif profit_per_bond > 0 %}
                    <span class="m pos">{{ "{:,.2f}".format(profit_per_bond) }}</span>
                {% else %}
                    <span class="m">{{ "{:,.2f}".format(profit_per_bond) }}</span>
                {% endif %}
            </td>
            <td>
                {% if bond_number > 1 %}
                    {% set full_profit = profit_per_bond * bond_number %}
                    {% if full_profit < 0 %}
                        <span class="m neg">{{ "{:,.2f}".format(full_profit) }}</span>
                    {% elif full_profit > 0 %}
                        <span class="m pos">{{ "{:,.2f}".format(full_profit) }}</span>
                    {% else %}
                        <span class="m">{{ "{:,.2f}".format(full_profit) }}</span>
                    {% endif %}
                {% else %}
                    /
                {% endif %}
            </td>
            <td>
                {% set returns = profit_per_bond /  bond.value * 100 %}
                {% if returns < 0 %}
                    <span class="p neg">{{ "{:,.2f}".format(returns) }}</span>
                {% elif returns > 0 %}
                    <span class="p pos">{{ "{:,.2f}".format(returns) }}</span>
                {% else %}
                    <span class="p">{{ "{:,.2f}".format(returns) }}</span>
                {% endif %}
            </td>
            <td>
                <button>BUY</button>
            </td>
        </tr>
    {% endfor %}
</table>
{% endblock %}